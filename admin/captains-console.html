<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ryder Weekend — Captain’s Console</title>
  <style>
    :root{
      --bg:#0b0f14;
      --ink:#eef2f7;
      --muted:#b7c0cc;
      --dim:#7f8a99;
      --line:rgba(255,255,255,.10);

      --gold:#d1a14b;
      --green:#3fbf7f;
      --red:#cc3b3b;
      --blue:#4aa6ff;

      --radius:18px;
      --shadow:0 18px 50px rgba(0,0,0,.45);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: var(--sans);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(74,166,255,.14), transparent 60%),
        radial-gradient(1000px 700px at 85% 0%, rgba(209,161,75,.12), transparent 60%),
        radial-gradient(900px 700px at 50% 110%, rgba(63,191,127,.09), transparent 60%),
        var(--bg);
      color: var(--ink);
      line-height: 1.35;
    }

    .topbar{
      position: sticky;
      top:0;
      z-index:20;
      padding: 14px 18px;
      border-bottom:1px solid var(--line);
      background: rgba(10,13,18,.78);
      backdrop-filter: blur(12px);
    }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .topbar .row{ justify-content:space-between; }
    .brand{ display:flex; gap:12px; align-items:center; min-width: 280px; }
    .badge{
      width:40px;height:40px;border-radius: 14px;
      display:grid;place-items:center;
      background: linear-gradient(135deg, rgba(209,161,75,.22), rgba(74,166,255,.18));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      font-weight:900; letter-spacing:.5px;
    }
    .brand h1{ margin:0; font-size: 16px; letter-spacing:.3px; }
    .brand .sub{ margin-top:2px; font-size:12px; color: var(--muted); }

    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      color: var(--ink);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 650;
      font-size: 13px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: transform .08s ease, background .12s ease, border-color .12s ease, opacity .12s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.11); border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ background: rgba(209,161,75,.18); border-color: rgba(209,161,75,.35); }
    .btn.good{ background: rgba(63,191,127,.16); border-color: rgba(63,191,127,.32); }
    .btn.bad{ background: rgba(204,59,59,.16); border-color: rgba(204,59,59,.30); }
    .btn.blue{ background: rgba(74,166,255,.14); border-color: rgba(74,166,255,.30); }
    .btn.small{ padding: 8px 10px; border-radius: 12px; font-size: 12px; }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }

    .pill{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
    }
    .kbd{
      font-family: var(--mono);
      font-size: 11px;
      padding: 5px 7px;
      border-radius: 10px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--muted);
    }

    main{ padding: 18px; max-width: 1300px; margin: 0 auto; }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.11);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding: 14px 14px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background: rgba(0,0,0,.16);
    }
    .card .hd h2{ margin:0; font-size: 14px; letter-spacing:.3px; }
    .card .bd{ padding: 14px; }

    .field{ display:flex; flex-direction:column; gap:6px; flex:1 1 180px; min-width: 180px; }
    label{ font-size: 12px; color: var(--muted); letter-spacing:.2px; }
    input, select{
      width:100%;
      padding: 10px 11px;
      border-radius: 14px;
      color: var(--ink);
      background: rgba(10,14,20,.62);
      border:1px solid rgba(255,255,255,.12);
      outline:none;
      font-size: 13px;
    }
    input::placeholder{ color: rgba(183,192,204,.55); }

    .split{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 620px){ .split{ grid-template-columns: 1fr; } }

    .teamBox{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      padding: 12px;
    }
    .teamBox .title{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom: 10px;
    }
    .teamBox .title .name{ font-weight: 900; letter-spacing:.2px; font-size: 13px; }
    .teamBox .title .tag{
      font-family: var(--mono);
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      color: var(--muted);
      background: rgba(255,255,255,.06);
    }

    .roster{ display:flex; flex-wrap:wrap; gap:8px; margin-top: 8px; }
    .chip{
      font-size: 12px;
      padding: 7px 9px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .chip button{
      appearance:none; border:none; background:transparent;
      color: rgba(255,255,255,.75); cursor:pointer;
      font-size: 14px; line-height: 1; padding: 0;
    }
    .chip button:hover{ color: white; }

    .matches{ display:flex; flex-direction:column; gap:10px; }
    .match{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .match .mhd{
      padding: 10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .match .mhd .left{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .id{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      padding: 6px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
    }
    .status{ font-weight: 900; letter-spacing:.2px; font-size: 13px; }
    .meta{ font-family: var(--mono); font-size: 12px; color: var(--muted); }

    .match .mbd{ padding: 12px; }
    .twoCol{ display:grid; grid-template-columns: 1.15fr .85fr; gap:12px; align-items:start; }
    @media (max-width: 820px){ .twoCol{ grid-template-columns: 1fr; } }

    .mini{
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      padding: 10px 12px;
    }
    .mini .t{ font-weight: 900; }
    .mini .s{ font-family: var(--mono); font-size:12px; color: var(--muted); margin-top:4px; }

    .footerNote{ margin-top: 10px; font-size: 12px; color: var(--dim); }

    .toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      max-width: 360px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(10,13,18,.80);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      color: var(--ink);
      display:none;
      z-index: 50;
    }
    .toast .t1{ font-weight: 900; font-size: 13px; margin-bottom: 4px; }
    .toast .t2{ font-size: 12px; color: var(--muted); }
  </style>
</head>

<body>
<header class="topbar">
  <div class="row">
    <div class="brand">
      <div class="badge">RW</div>
      <div>
        <h1>Ryder Weekend — Captain’s Console</h1>
        <div class="sub">Rosters • Pairings • Results • Export/Import</div>
      </div>
    </div>

    <div class="row">
      <span class="pill">Storage: <span class="kbd">rw_captains_console_v2</span></span>
      <button class="btn good" id="btnLock">Lock Pairings</button>
      <button class="btn" id="btnExport">Export</button>
      <button class="btn" id="btnImport">Import</button>
      <button class="btn bad" id="btnReset">Reset Demo</button>
    </div>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card">
      <div class="hd">
        <h2>Event Setup</h2>
        <div class="row">
          <span class="pill" id="lockPill">Unlocked</span>
        </div>
      </div>
      <div class="bd">
        <div class="row">
          <div class="field">
            <label>Event name</label>
            <input id="eventName" placeholder="Ozark Invitational — Ryder Weekend" />
          </div>
          <div class="field">
            <label>Session label</label>
            <input id="sessionName" placeholder="Day 1 — Morning" />
          </div>
        </div>

        <div style="height:14px;"></div>

        <div class="split">
          <div class="teamBox">
            <div class="title">
              <div>
                <div class="name" id="teamANameLabel">Ozark</div>
                <div class="footerNote" style="margin:0;">Roster</div>
              </div>
              <div class="tag">TEAM A</div>
            </div>
            <div class="row">
              <div class="field">
                <label>Team name</label>
                <input id="teamAName" placeholder="Ozark" />
              </div>
              <div class="field">
                <label>Add player</label>
                <div class="row">
                  <input id="teamAPlayer" placeholder="Player name" />
                  <button class="btn small" id="btnAddA">Add</button>
                </div>
              </div>
            </div>
            <div class="roster" id="rosterA"></div>
          </div>

          <div class="teamBox">
            <div class="title">
              <div>
                <div class="name" id="teamBNameLabel">Valley</div>
                <div class="footerNote" style="margin:0;">Roster</div>
              </div>
              <div class="tag">TEAM B</div>
            </div>
            <div class="row">
              <div class="field">
                <label>Team name</label>
                <input id="teamBName" placeholder="Valley" />
              </div>
              <div class="field">
                <label>Add player</label>
                <div class="row">
                  <input id="teamBPlayer" placeholder="Player name" />
                  <button class="btn small" id="btnAddB">Add</button>
                </div>
              </div>
            </div>
            <div class="roster" id="rosterB"></div>
          </div>
        </div>

        <div class="footerNote">
          Lock pairings once teams + matches are finalized, so nobody bumps something mid-event.
        </div>
      </div>
    </section>

    <section class="card">
      <div class="hd">
        <h2>Captain Tools</h2>
        <div class="row">
          <button class="btn small blue" id="btnAddMatch">+ Add Match</button>
        </div>
      </div>
      <div class="bd">
        <div class="mini">
          <div class="t">Scope</div>
          <div class="s">
            Captain input only — rosters, pairings, and results.<br/>
            No broadcast controls. No hole-by-hole tracking.
          </div>
        </div>
      </div>
    </section>
  </div>

  <div style="height:16px;"></div>

  <section class="card">
    <div class="hd">
      <h2>Pairings & Results</h2>
      <div class="row">
        <span class="pill">Match points: <span class="kbd">1</span> win • <span class="kbd">0.5</span> halve • <span class="kbd">0</span> loss</span>
      </div>
    </div>
    <div class="bd">
      <div class="matches" id="matches"></div>
      <div class="footerNote" id="pointsSummary"></div>
    </div>
  </section>
</main>

<div class="toast" id="toast">
  <div class="t1" id="toastTitle">Saved</div>
  <div class="t2" id="toastBody">Local storage updated.</div>
</div>

<input type="file" id="importFile" accept="application/json" style="display:none;" />

<script>
  const STORAGE_KEY = "rw_captains_console_v2";

  const $ = (sel) => document.querySelector(sel);

  // ✅ FIX: normalize event names to lowercase so onClick works.
  const el = (tag, attrs={}, kids=[]) => {
    const n = document.createElement(tag);
    Object.entries(attrs).forEach(([k,v])=>{
      if(k==="class") n.className = v;
      else if(k==="html") n.innerHTML = v;
      else if(k.startsWith("on") && typeof v === "function"){
        n.addEventListener(k.slice(2).toLowerCase(), v);
      } else n.setAttribute(k, v);
    });
    kids.forEach(k => n.appendChild(k));
    return n;
  };

  function toast(title, body){
    const box = $("#toast");
    $("#toastTitle").textContent = title;
    $("#toastBody").textContent = body;
    box.style.display = "block";
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(()=> box.style.display="none", 2200);
  }

  function safeName(s){ return (s||"").trim().replace(/\s+/g," ").slice(0,40); }

  function demoState(){
    return {
      version: 2,
      eventName: "Ozark Invitational — Ryder Weekend",
      sessionName: "Day 1 — Morning",
      locked: false,
      teams: {
        A: { name:"Ozark", players:["Nick","Migs","Logan","Cody"] },
        B: { name:"Valley", players:["Brad","Evan","Tanner","Chase"] }
      },
      matches: [
        makeMatch("M1","Best Ball", ["Nick","Migs"], ["Brad","Evan"]),
        makeMatch("M2","Scramble", ["Logan","Cody"], ["Tanner","Chase"])
      ]
    };
  }

  function makeMatch(id, format, teamAPlayers, teamBPlayers){
    return {
      id,
      format,
      teeTime: "",
      teamAPlayers,
      teamBPlayers,
      result: "pending", // pending|A|B|halve
      pointsA: 0,
      pointsB: 0,
      notes: ""
    };
  }

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return demoState();
      const s = JSON.parse(raw);
      if(!s || typeof s !== "object") return demoState();
      s.version = 2;
      s.locked = !!s.locked;
      s.eventName = s.eventName || demoState().eventName;
      s.sessionName = s.sessionName || demoState().sessionName;
      s.teams = s.teams || demoState().teams;
      s.matches = Array.isArray(s.matches) ? s.matches : demoState().matches;
      return s;
    }catch(e){
      return demoState();
    }
  }

  let state = loadState();

  function saveState(opts={quiet:false}){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    if(!opts.quiet) toast("Saved", "Captain’s Console updated.");
  }

  function setLocked(v){
    state.locked = !!v;
    $("#lockPill").textContent = state.locked ? "Locked" : "Unlocked";
    $("#btnLock").textContent = state.locked ? "Unlock Pairings" : "Lock Pairings";
    $("#btnAddMatch").disabled = state.locked;
  }

  function computePoints(){
    let a=0, b=0;
    state.matches.forEach(m=>{
      a += Number(m.pointsA||0);
      b += Number(m.pointsB||0);
    });
    return {a,b};
  }

  function render(){
    $("#eventName").value = state.eventName || "";
    $("#sessionName").value = state.sessionName || "";

    $("#teamAName").value = state.teams.A.name || "";
    $("#teamBName").value = state.teams.B.name || "";
    $("#teamANameLabel").textContent = state.teams.A.name || "Team A";
    $("#teamBNameLabel").textContent = state.teams.B.name || "Team B";

    renderRoster("A", $("#rosterA"));
    renderRoster("B", $("#rosterB"));

    const wrap = $("#matches");
    wrap.innerHTML = "";
    state.matches.forEach(m => wrap.appendChild(renderMatch(m)));

    const pts = computePoints();
    $("#pointsSummary").textContent =
      `Session points — ${state.teams.A.name}: ${pts.a} • ${state.teams.B.name}: ${pts.b}`;

    setLocked(state.locked);

    $("#teamAName").disabled = state.locked;
    $("#teamBName").disabled = state.locked;
    $("#teamAPlayer").disabled = state.locked;
    $("#teamBPlayer").disabled = state.locked;
    $("#btnAddA").disabled = state.locked;
    $("#btnAddB").disabled = state.locked;
  }

  function renderRoster(teamKey, host){
    host.innerHTML = "";
    const team = state.teams[teamKey];
    (team.players||[]).forEach((p, idx) => {
      const chip = el("span", {class:"chip"}, [
        document.createTextNode(p),
        el("button", {
          title:"Remove",
          onClick: ()=> {
            if(state.locked){ toast("Locked", "Unlock to edit rosters."); return; }
            team.players.splice(idx,1);
            state.matches.forEach(m=>{
              if(teamKey==="A") m.teamAPlayers = (m.teamAPlayers||[]).filter(x=>x!==p);
              if(teamKey==="B") m.teamBPlayers = (m.teamBPlayers||[]).filter(x=>x!==p);
            });
            saveState();
            render();
          }
        }, [document.createTextNode("×")])
      ]);
      host.appendChild(chip);
    });
  }

  function matchLabel(m){
    const A = state.teams.A.name, B = state.teams.B.name;
    if(m.result==="pending") return "Pending";
    if(m.result==="halve") return "Halved";
    return m.result==="A" ? `${A} wins` : `${B} wins`;
  }

  function renderMatch(m){
    const A = state.teams.A.name, B = state.teams.B.name;

    const header = el("div", {class:"mhd"}, []);
    const left = el("div", {class:"left"}, [
      el("span", {class:"id"}, [document.createTextNode(m.id)]),
      el("span", {class:"status"}, [document.createTextNode(matchLabel(m))]),
    ]);
    const right = el("div", {class:"row"}, [
      el("span", {class:"meta"}, [document.createTextNode(`${m.format}`)]),
      el("button", {
        class:"btn small bad",
        onClick: ()=> {
          if(state.locked){ toast("Locked", "Unlock to remove matches."); return; }
          state.matches = state.matches.filter(x=>x.id!==m.id);
          saveState();
          render();
        }
      }, [document.createTextNode("Remove")])
    ]);
    header.appendChild(left);
    header.appendChild(right);

    const body = el("div", {class:"mbd"}, []);
    const two = el("div", {class:"twoCol"}, []);

    const leftCol = el("div", {}, []);
    const pRow = el("div", {class:"row"}, [
      pairingField(`${A} players`, m.teamAPlayers, (arr)=>{ m.teamAPlayers = arr; }),
      pairingField(`${B} players`, m.teamBPlayers, (arr)=>{ m.teamBPlayers = arr; })
    ]);
    leftCol.appendChild(pRow);

    const settingsRow = el("div", {class:"row", style:"margin-top:10px;"}, [
      formatField(m),
      textField("Tee time", m.teeTime||"", (v)=>{ m.teeTime=v; }),
    ]);
    leftCol.appendChild(settingsRow);

    const notes = el("div", {class:"field", style:"margin-top:10px;"}, [
      el("label", {}, [document.createTextNode("Notes (optional)")]),
      (() => {
        const i = el("input", {placeholder:"Anything captains need to remember"});
        i.value = m.notes || "";
        i.disabled = state.locked;
        i.addEventListener("input", ()=>{ m.notes = i.value; saveState({quiet:true}); });
        i.addEventListener("change", ()=>{ saveState(); });
        return i;
      })()
    ]);
    leftCol.appendChild(notes);

    const rightCol = el("div", {}, []);
    const resultBox = el("div", {class:"teamBox"}, []);
    resultBox.appendChild(el("div", {class:"title"}, [
      el("div", {}, [
        el("div", {class:"name"}, [document.createTextNode("Result")]),
        el("div", {class:"footerNote", style:"margin:0;"}, [document.createTextNode("Set outcome and points")])
      ]),
      el("div", {class:"tag"}, [document.createTextNode(`${m.pointsA}–${m.pointsB}`)])
    ]));

    const resultRow = el("div", {class:"row"}, [
      el("button", {class:"btn small good", onClick: ()=> setResult(m,"A")}, [document.createTextNode(`${A} win`)]),
      el("button", {class:"btn small bad",  onClick: ()=> setResult(m,"B")}, [document.createTextNode(`${B} win`)]),
      el("button", {class:"btn small",      onClick: ()=> setResult(m,"halve")}, [document.createTextNode("Halve")]),
      el("button", {class:"btn small",      onClick: ()=> setResult(m,"pending")}, [document.createTextNode("Pending")]),
    ]);
    [...resultRow.querySelectorAll("button")].forEach(btn=> btn.disabled = state.locked);
    resultBox.appendChild(resultRow);

    const pointsRow = el("div", {class:"row", style:"margin-top:10px;"}, [
      pointsField(`${A} points`, m.pointsA, (v)=>{ m.pointsA=v; }),
      pointsField(`${B} points`, m.pointsB, (v)=>{ m.pointsB=v; })
    ]);
    resultBox.appendChild(pointsRow);

    resultBox.appendChild(el("div", {class:"footerNote"}, [
      document.createTextNode("Buttons auto-fill 1 / 0.5 / 0. Override manually if needed.")
    ]));

    rightCol.appendChild(resultBox);

    two.appendChild(leftCol);
    two.appendChild(rightCol);
    body.appendChild(two);

    return el("div", {class:"match"}, [header, body]);
  }

  function pairingField(labelText, arr, setter){
    const field = el("div", {class:"field", style:"min-width:260px; flex:1 1 260px;"}, [
      el("label", {}, [document.createTextNode(labelText)])
    ]);
    const i = el("input", {placeholder:"e.g., Nick, Migs"});
    i.value = (arr||[]).join(", ");
    i.disabled = state.locked;
    i.addEventListener("change", ()=>{
      if(state.locked) return;
      const names = i.value.split(",").map(s=>safeName(s)).filter(Boolean);
      setter(names);
      saveState();
      render();
    });
    field.appendChild(i);
    return field;
  }

  function formatField(m){
    const field = el("div", {class:"field"}, [ el("label", {}, [document.createTextNode("Format")]) ]);
    const s = el("select", {});
    ["Best Ball","Scramble","Alternate Shot","Singles","Shamble","Other"].forEach(opt=>{
      const o = el("option", {value:opt}, [document.createTextNode(opt)]);
      if(m.format === opt) o.selected = true;
      s.appendChild(o);
    });
    s.disabled = state.locked;
    s.addEventListener("change", ()=>{
      m.format = s.value;
      saveState();
      render();
    });
    field.appendChild(s);
    return field;
  }

  function textField(labelText, value, onSet){
    const field = el("div", {class:"field"}, [ el("label", {}, [document.createTextNode(labelText)]) ]);
    const i = el("input", {});
    i.value = value || "";
    i.disabled = state.locked;
    i.addEventListener("input", ()=>{ onSet(i.value); saveState({quiet:true}); });
    i.addEventListener("change", ()=>{ saveState(); render(); });
    field.appendChild(i);
    return field;
  }

  function pointsField(labelText, value, onSet){
    const field = el("div", {class:"field", style:"min-width:170px; flex:1 1 170px;"}, [
      el("label", {}, [document.createTextNode(labelText)])
    ]);
    const i = el("input", {type:"number", step:"0.5", min:"0", max:"2"});
    i.value = String(value ?? 0);
    i.disabled = state.locked;
    i.addEventListener("change", ()=>{
      let v = parseFloat(i.value);
      if(Number.isNaN(v)) v = 0;
      v = Math.max(0, Math.min(2, v));
      v = Math.round(v * 2) / 2;
      i.value = String(v);
      onSet(v);
      saveState();
      render();
    });
    field.appendChild(i);
    return field;
  }

  function setResult(m, r){
    if(state.locked){ toast("Locked", "Unlock to edit results."); return; }
    m.result = r;
    if(r==="A"){ m.pointsA = 1; m.pointsB = 0; }
    else if(r==="B"){ m.pointsA = 0; m.pointsB = 1; }
    else if(r==="halve"){ m.pointsA = 0.5; m.pointsB = 0.5; }
    else { m.pointsA = 0; m.pointsB = 0; }
    saveState();
    render();
  }

  // Top-level controls (these already worked, keeping them explicit)
  $("#eventName").addEventListener("input", ()=>{ state.eventName = $("#eventName").value.slice(0,80); saveState({quiet:true}); });
  $("#sessionName").addEventListener("input", ()=>{ state.sessionName = $("#sessionName").value.slice(0,80); saveState({quiet:true}); });

  $("#teamAName").addEventListener("input", ()=>{
    if(state.locked) return;
    state.teams.A.name = safeName($("#teamAName").value) || "Team A";
    saveState({quiet:true}); render();
  });
  $("#teamBName").addEventListener("input", ()=>{
    if(state.locked) return;
    state.teams.B.name = safeName($("#teamBName").value) || "Team B";
    saveState({quiet:true}); render();
  });

  $("#btnAddA").addEventListener("click", ()=>{
    if(state.locked){ toast("Locked", "Unlock to edit rosters."); return; }
    const v = safeName($("#teamAPlayer").value);
    if(!v) return;
    if(!state.teams.A.players.includes(v)) state.teams.A.players.push(v);
    $("#teamAPlayer").value = "";
    saveState(); render();
  });

  $("#btnAddB").addEventListener("click", ()=>{
    if(state.locked){ toast("Locked", "Unlock to edit rosters."); return; }
    const v = safeName($("#teamBPlayer").value);
    if(!v) return;
    if(!state.teams.B.players.includes(v)) state.teams.B.players.push(v);
    $("#teamBPlayer").value = "";
    saveState(); render();
  });

  $("#btnAddMatch").addEventListener("click", ()=>{
    if(state.locked){ toast("Locked", "Unlock to add matches."); return; }
    const id = `M${state.matches.length + 1}`;
    state.matches.push(makeMatch(id, "Best Ball", [], []));
    saveState(); render();
    toast("Match added", `${id} created.`);
  });

  $("#btnLock").addEventListener("click", ()=>{
    state.locked = !state.locked;
    saveState(); render();
    toast(state.locked ? "Locked" : "Unlocked", state.locked ? "Pairings/results protected." : "Edits enabled.");
  });

  $("#btnExport").addEventListener("click", ()=>{
    const payload = JSON.stringify(state, null, 2);
    const blob = new Blob([payload], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    const safe = (state.eventName || "ryder_weekend").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");
    a.download = `${safe}_captains_console.json`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    toast("Exported", "Downloaded state JSON.");
  });

  $("#btnImport").addEventListener("click", ()=> $("#importFile").click());
  $("#importFile").addEventListener("change", async (ev)=>{
    const file = ev.target.files && ev.target.files[0];
    if(!file) return;
    try{
      const text = await file.text();
      const parsed = JSON.parse(text);
      if(!parsed || typeof parsed !== "object") throw new Error("Invalid");
      state = parsed;
      state.version = 2;
      state.locked = !!state.locked;
      state.teams = state.teams || demoState().teams;
      state.matches = Array.isArray(state.matches) ? state.matches : [];
      saveState(); render();
      toast("Imported", "State loaded.");
    }catch(e){
      toast("Import failed", "That file didn’t parse as valid console JSON.");
    }finally{
      $("#importFile").value = "";
    }
  });

  $("#btnReset").addEventListener("click", ()=>{
    state = demoState();
    saveState(); render();
    toast("Reset", "Demo data restored.");
  });

  // boot
  saveState({quiet:true});
  render();
</script>
</body>
</html>
