<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scoreboard — Ozark Invitational</title>
  <style>
    :root{
      --green:#244f3c; --green-dark:#163023; --gold:#d1a14b; --cream:#f5f0e6; --bg:#fcfaf6; --text:#222;
      --radius:16px; --shadow:0 14px 36px rgba(0,0,0,.08);
      --oz:#2ecc71; --va:#3498db;
      --fs:1; /* UI scale */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,sans-serif; line-height:1.5}

    .wrap{max-width:1200px;margin:28px auto;padding:16px; transform:scale(var(--fs)); transform-origin: top center}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px}
    h1{margin:0;color:var(--green);letter-spacing:.02em}
    .sub{margin:4px 0 0;color:#5b5b5b}

    .panel{background:var(--cream);border:1px solid #e7e1d6;border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .grid{display:grid;gap:14px}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .grid.cols-2{grid-template-columns:1.3fr .7fr}
    @media (max-width:1100px){ .grid.cols-3{grid-template-columns:1fr} .grid.cols-2{grid-template-columns:1fr} }

    .btn{appearance:none;border:1px solid var(--green);background:var(--green);color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.ghost{background:#fff;color:var(--green)}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    select,input[type="number"]{padding:8px 10px;border:1px solid #c9c3b8;border-radius:10px;background:#fff}

    /* Team score bar */
    .scorebar{display:flex;gap:14px;align-items:center}
    .bar{position:relative;height:22px;border:1px solid #d8d0c2;background:#fff;border-radius:999px;overflow:hidden;flex:1}
    .fillA,.fillB{position:absolute;top:0;bottom:0}
    .fillA{left:0;background:linear-gradient(90deg,var(--oz),#25a65b)}
    .fillB{right:0;background:linear-gradient(90deg,#2a6ea8,var(--va))}
    .ticks{display:flex;gap:8px;margin-top:6px;font-size:12px;color:#6b614f}
    .kpi{display:flex;gap:8px;align-items:center;font-weight:800}
    .pill{padding:4px 8px;border:1px solid #d8d0c2;border-radius:999px;background:#fff}

    /* Tables */
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden}
    thead th{position:sticky;top:0;background:#f7f4ed;border-bottom:1px solid #e5ddcf;padding:10px;text-align:left;font-size:14px}
    tbody td{padding:10px;border-bottom:1px solid #efe8db;vertical-align:middle}
    tbody tr:nth-child(odd){background:#faf7f1}
    .num{text-align:right;font-variant-numeric:tabular-nums}

    .title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .badge{padding:4px 10px;border-radius:999px;background:#fff;border:1px solid #d8d0c2;font-weight:800}

    /* Winner banner */
    .banner{display:none;margin-top:10px;padding:12px;border-radius:12px;background:#d1e7dd;border:1px solid #badbcc;color:#0f5132;font-weight:900}
    .banner.show{display:block}

    /* Ticker */
    .ticker{overflow:hidden;white-space:nowrap;border-top:1px dashed #e0d8c8;color:#6b614f;padding-top:10px;font-size:14px}
    .ticker span{margin-right:24px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Event Scoreboard</h1>
        <div class="sub">Auto-syncs with your Leaderboard & Ryder pages (localStorage).</div>
      </div>
      <div class="row">
        <button class="btn" id="btnFullscreen">Fullscreen</button>
        <label class="pill">Refresh:
          <select id="refreshRate">
            <option value="0">Paused</option>
            <option value="3000">3s</option>
            <option value="5000" selected>5s</option>
            <option value="10000">10s</option>
          </select>
        </label>
        <label class="pill">Scale:
          <select id="scaleSel">
            <option value="0.9">90%</option>
            <option value="1" selected>100%</option>
            <option value="1.1">110%</option>
            <option value="1.2">120%</option>
          </select>
        </label>
      </div>
    </header>

    <!-- Ryder Team vs Team -->
    <section class="panel" id="ryderPanel">
      <div class="title">
        <div class="row">
          <span class="badge">Ryder Points</span>
          <span id="ryMeta" class="sub"></span>
        </div>
        <div id="winnerBanner" class="banner"></div>
      </div>

      <div class="scorebar">
        <div class="kpi" id="labelA"><span style="width:12px;height:12px;border-radius:50%;background:var(--oz);display:inline-block"></span><span>Team A</span><span id="ptsA">0</span></div>
        <div class="bar">
          <div class="fillA" id="fillA" style="width:0%"></div>
          <div class="fillB" id="fillB" style="width:0%"></div>
        </div>
        <div class="kpi" id="labelB"><span style="width:12px;height:12px;border-radius:50%;background:var(--va);display:inline-block"></span><span>Team B</span><span id="ptsB">0</span></div>
      </div>
      <div class="ticks" id="ryTicks"></div>
      <div class="ticker" id="ryTicker"></div>
    </section>

    <!-- Leader lists -->
    <section class="grid cols-3" style="margin-top:14px">
      <div class="panel">
        <div class="title"><h3 style="margin:0">Top 10 — Gross</h3><span class="badge" id="grossParBadge">Par: —</span></div>
        <div style="overflow:auto;border-radius:12px">
          <table id="tblGross">
            <thead><tr><th>#</th><th>Player</th><th>Team</th><th class="num">R1</th><th class="num">R2</th><th class="num">R3</th><th class="num">R4</th><th class="num">Gross</th><th class="num">±Par</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="panel">
        <div class="title"><h3 style="margin:0">Top 10 — Net</h3><span class="badge">HCP Applied</span></div>
        <div style="overflow:auto;border-radius:12px">
          <table id="tblNet">
            <thead><tr><th>#</th><th>Player</th><th>Team</th><th class="num">Gross</th><th class="num">HCP</th><th class="num">Net</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="panel">
        <div class="title"><h3 style="margin:0">Round Leaders</h3><span class="badge" id="rlParBadge">Pars set per round</span></div>
        <div style="overflow:auto;border-radius:12px">
          <table id="tblRounds">
            <thead><tr><th>Round</th><th>Leader</th><th class="num">Score</th><th class="num">±Par</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

<script>
/* ===== Keys shared with leaderboard.html ===== */
const LS_KEY = 'scoreboard_players_v8';
const PAR_KEY = 'scoreboard_par_v1';
const RYDER_KEY = 'scoreboard_ryder_v3';

/* ===== State ===== */
let players = [];
let par = { r1:null, r2:null, r3:null, r4:null };
let ryder = { teams:[], teamA:null, teamB:null, roundFormat:{r1:'Best Ball',r2:'Scramble',r3:'Alt Shot',r4:'Singles'}, matches:{r1:[],r2:[],r3:[],r4:[]} };
let refreshTimer = null;

/* ===== Elements ===== */
const ptsA = document.getElementById('ptsA');
const ptsB = document.getElementById('ptsB');
const fillA = document.getElementById('fillA');
const fillB = document.getElementById('fillB');
const labelA = document.getElementById('labelA');
const labelB = document.getElementById('labelB');
const ryMeta = document.getElementById('ryMeta');
const ryTicks = document.getElementById('ryTicks');
const ryTicker = document.getElementById('ryTicker');
const winnerBanner = document.getElementById('winnerBanner');
const grossParBadge = document.getElementById('grossParBadge');
const rlParBadge = document.getElementById('rlParBadge');

const tblGross = document.querySelector('#tblGross tbody');
const tblNet   = document.querySelector('#tblNet tbody');
const tblRounds= document.querySelector('#tblRounds tbody');

const scaleSel = document.getElementById('scaleSel');
const refreshSel = document.getElementById('refreshRate');
const btnFullscreen = document.getElementById('btnFullscreen');

/* ===== Utils ===== */
const sum = arr => arr.reduce((s,v)=>s+(Number.isFinite(v)?v:0),0);
const esc = s => String(s??'').replace(/[&<>]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c]));
function loadAll(){
  try{ const raw = localStorage.getItem(LS_KEY); if(raw) players = JSON.parse(raw)||[]; else players = []; }catch{ players = []; }
  try{ const rp = localStorage.getItem(PAR_KEY); if(rp) par = {...par, ...(JSON.parse(rp)||{})}; }catch{}
  try{ const rr = localStorage.getItem(RYDER_KEY); if(rr) ryder = {...ryder, ...(JSON.parse(rr)||{})}; }catch{}
}
function toParRound(score, rkey){
  if(!Number.isFinite(score) || !Number.isFinite(par[rkey])) return '';
  const d = score - par[rkey];
  return (d>0?'+':'') + d;
}
function toParTotal(total){
  const vals=[par.r1,par.r2,par.r3,par.r4].filter(n=>Number.isFinite(n));
  if(!vals.length) return '';
  const pSum = vals.reduce((a,b)=>a+b,0);
  const diff = total - pSum;
  return (diff>0?'+':'') + diff;
}

/* ===== Renderers ===== */
function renderRyder(){
  // Compute points
  let A=0,B=0, created=0;
  const tickMsgs = [];
  const teamA = ryder.teamA || 'Team A';
  const teamB = ryder.teamB || 'Team B';
  (['r1','r2','r3','r4']).forEach(r=>{
    (ryder.matches[r]||[]).forEach(m=>{
      created += 1;
      if(m.result==='A'){ A+=1; tickMsgs.push(`${teamA} win (${r.toUpperCase()})`); }
      else if(m.result==='B'){ B+=1; tickMsgs.push(`${teamB} win (${r.toUpperCase()})`); }
      else if(m.result==='H'){ A+=.5; B+=.5; tickMsgs.push(`Half point each (${r.toUpperCase()})`); }
    });
  });

  ptsA.textContent = A;
  ptsB.textContent = B;
  labelA.querySelector('span + span').textContent = teamA;
  labelB.querySelector('span + span').textContent = teamB;

  const totalPts = Math.max(1, created); // avoid /0
  const aPct = Math.min(100, (A/totalPts)*100);
  const bPct = Math.min(100, (B/totalPts)*100);
  fillA.style.width = aPct + '%';
  fillB.style.width = bPct + '%';

  ryMeta.textContent = created ? `Matches created: ${created} • Majority to clinch: ${Math.floor(created/2)+1}` : 'No matches created yet';
  ryTicks.innerHTML = created ? Array.from({length:created}, (_,i)=>`<span>•</span>`).join('') : '';

  // Winner / clinch
  const majority = created/2;
  let msg = '';
  if(created===0){
    msg = '';
  } else if (A>majority){
    msg = `${teamA} have clinched! (${A} – ${B})`;
  } else if (B>majority){
    msg = `${teamB} have clinched! (${B} – ${A})`;
  } else {
    const needA = Math.max(0, Math.floor(majority+1 - A));
    const needB = Math.max(0, Math.floor(majority+1 - B));
    msg = `First to ${Math.floor(majority)+1} points clinches • ${teamA} need ~${needA}, ${teamB} need ~${needB}`;
  }
  if(msg){ winnerBanner.textContent = msg; winnerBanner.classList.add('show'); }
  else { winnerBanner.textContent = ''; winnerBanner.classList.remove('show'); }

  // Ticker
  ryTicker.innerHTML = tickMsgs.slice(-12).map(t=>`<span>${esc(t)}</span>`).join('');
}

function renderLeaders(){
  // Gross top 10
  const rowsGross = players.map(p=>{
    const r1=p.r1, r2=p.r2, r3=p.r3, r4=p.r4;
    const gross = sum([r1,r2,r3,r4]);
    return {p, gross, r1, r2, r3, r4, toPar: toParTotal(gross)};
  }).filter(x=>Number.isFinite(x.gross))
    .sort((a,b)=>a.gross-b.gross || (a.p.lastName||'').localeCompare(b.p.lastName||'') || (a.p.firstName||'').localeCompare(b.p.firstName||''))
    .slice(0,10);

  tblGross.innerHTML = rowsGross.map((row,i)=>{
    const n = row.p.nickname ? ` <span style="color:#6b614f">(${esc(row.p.nickname)})</span>` : '';
    return `<tr>
      <td>${i+1}</td>
      <td>${esc(row.p.firstName||'')} ${esc(row.p.lastName||'')}${n}</td>
      <td>${esc(row.p.team||'')}</td>
      <td class="num">${Number.isFinite(row.r1)?row.r1:''}</td>
      <td class="num">${Number.isFinite(row.r2)?row.r2:''}</td>
      <td class="num">${Number.isFinite(row.r3)?row.r3:''}</td>
      <td class="num">${Number.isFinite(row.r4)?row.r4:''}</td>
      <td class="num">${row.gross}</td>
      <td class="num">${row.toPar}</td>
    </tr>`;
  }).join('') || `<tr><td colspan="9" class="num" style="text-align:center;color:#6b614f">No scores yet.</td></tr>`;

  // Net top 10
  const rowsNet = players.map(p=>{
    const gross = sum([p.r1,p.r2,p.r3,p.r4]);
    const h = Number.isFinite(p.handicap) ? p.handicap : null;
    const net = (Number.isFinite(gross) && h!=null) ? Math.max(0, gross - h) : null;
    return {p, gross, net, h};
  }).filter(x=>Number.isFinite(x.net))
    .sort((a,b)=>a.net-b.net || (a.p.lastName||'').localeCompare(b.p.lastName||'') || (a.p.firstName||'').localeCompare(b.p.firstName||''))
    .slice(0,10);

  tblNet.innerHTML = rowsNet.map((row,i)=>{
    return `<tr>
      <td>${i+1}</td>
      <td>${esc(row.p.firstName||'')} ${esc(row.p.lastName||'')}</td>
      <td>${esc(row.p.team||'')}</td>
      <td class="num">${row.gross}</td>
      <td class="num">${Number.isFinite(row.h)?row.h:''}</td>
      <td class="num">${row.net}</td>
    </tr>`;
  }).join('') || `<tr><td colspan="6" class="num" style="text-align:center;color:#6b614f">No handicaps/scores to compute net.</td></tr>`;

  // Round leaders (Top 5 across R1–R4)
  const rounds = ['r1','r2','r3','r4'];
  const body = rounds.map(r=>{
    const list = players.filter(p=>Number.isFinite(p[r]))
      .sort((a,b)=>a[r]-b[r] || (a.lastName||'').localeCompare(b.lastName||'') || (a.firstName||'').localeCompare(b.firstName||''))
      .slice(0,5);
    const rows = list.map((p,i)=>`<tr>
      <td>${r.toUpperCase()} ${i===0?'<span class="badge" style="margin-left:8px">Leader</span>':''}</td>
      <td>${esc(p.firstName||'')} ${esc(p.lastName||'')}</td>
      <td class="num">${p[r]}</td>
      <td class="num">${toParRound(p[r], r)}</td>
    </tr>`).join('');
    return rows || `<tr><td>${r.toUpperCase()}</td><td style="color:#6b614f">No scores</td><td class="num"></td><td class="num"></td></tr>`;
  }).join('');
  tblRounds.innerHTML = body;

  // Par badges
  const pSet = [par.r1,par.r2,par.r3,par.r4].filter(n=>Number.isFinite(n));
  grossParBadge.textContent = 'Par: ' + (pSet.length ? pSet.reduce((a,b)=>a+b,0) : '—');
  rlParBadge.textContent = `Pars: R1 ${par.r1??'—'} • R2 ${par.r2??'—'} • R3 ${par.r3??'—'} • R4 ${par.r4??'—'}`;
}

function renderAll(){
  loadAll();
  renderRyder();
  renderLeaders();
}

/* ===== Controls ===== */
scaleSel.addEventListener('change', ()=>{
  document.documentElement.style.setProperty('--fs', scaleSel.value);
});
refreshSel.addEventListener('change', ()=>{
  if(refreshTimer) clearInterval(refreshTimer);
  const ms = Number(refreshSel.value||0);
  if(ms>0){ refreshTimer = setInterval(renderAll, ms); }
});
btnFullscreen.addEventListener('click', ()=>{
  if(!document.fullscreenElement){ document.documentElement.requestFullscreen().catch(()=>{}); }
  else { document.exitFullscreen().catch(()=>{}); }
});

/* ===== Boot ===== */
renderAll();
if(Number(refreshSel.value)>0){ refreshTimer = setInterval(renderAll, Number(refreshSel.value)); }
</script>
</body>
</html>
